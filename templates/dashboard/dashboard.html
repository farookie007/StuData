{% extends 'base/base.html' %}
{% load static %}


{% block title %}Dashboard{% endblock title %}

{% block head %}
{% endblock head %}


{% block content %}
<div class="container">
    <div id="bio-data">
        <div id="hide">
            <img src="{% static 'images/icons/eye-svgrepo-com.svg' %}" alt="" class="eye">
            <img src="{% static 'images/icons/eye-slash-svgrepo-com.svg' %}" alt="" class="eye no-show">
        </div>
        <div class="name">
            <span class="surname">{{ user.last_name|upper }},</span><br>
            {{ user.first_name }} {{ user.middle_name }}
        </div>
        <div id="cred" class="flex">
            <p id="matric">{{ user.matric }}</p>
            <div id="cgpa">
                <div id="refresh" class="no-show">
                    <img src="{% static 'images/icons/refresh-cw-svgrepo-com.svg' %}" alt="" class="eye">
                </div>
                <p id="cgpa_value" class="no-show">
                    {{ user.cgpa|floatformat:2 }}
                </p>
                <p>
                    ****
                </p>
            </div>
        </div>
    </div>

</div>

<main>
    {% for result in user.results.all %}

    <div class="results">
        {% include 'results/includes/table.html' with result=result %}
    </div>
    {% endfor %}
</main>
{% endblock content %}
{% block script %}
var refreshBtn = document.querySelector("#refresh");
var cgpaVal = document.querySelector("#cgpa_value);

function ajaxCall() {
    $.ajax({
        url: "{% url 'dashboard:refresh' %}", 
        type: "GET",
        success: function (data) {
            var cgpa = cgpaVal.innerHTML;
            let new_cgpa = JSON.parse(data).cgpa;
            cgpaVal.innnerHTML = new_cgpa;
            },
        error: function (error) {
            cgpaVal.innerHTML = cgpa;
            console.log(`Error ${error}`);
            }
        });
    }

refreshBtn.addEventListener("click", ajaxCall());
{% endblock script %}